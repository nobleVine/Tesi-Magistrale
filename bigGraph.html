<html>

<head>

    <title>
        Big Graph
    </title>

    <style>
        .dot {
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        input.text {
            width: 50px;
            height: auto;
        }

        input.button {
            width: 130px;
            height: 35px;
            background-color: #d6d6c2;
            border-radius: 6px;
            font-style: italic;
            font-size: 20;
        }

        #graph {
            width: 1500px;
            height: 1500px;
        }

        #info {
            width: 100%;
            height: 300px;
        }

        body {
            background-color: #D3D3D3;
        }

        legend {
            display: inline-block;
            width: auto;
        }

        fieldset {
            display: inline-block;
            border: 2px black solid;
            width: auto;
            height: auto;
            position: relative;
            bottom: 260px;
            left: 250px;
        }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>

<body>

    <div id="info" style="float: center;">

        <h3>
            <b>Insert two strip of nodes (a number between 1 and 7) to draw only the edges which connect the nodes of
                the two strips
            </b>
        </h3>

        <h3>
            <b>
                first strip
            </b>
        </h3>
        <input class="text" type="text" id="input">
        <br>
        <br>
        <h3>
            <b>
                second strip
            </b>
        </h3>
        <input class="text" type="text" id="input2">
        <br>
        <br>
        <input class="button" type="submit" value="Draw edges!" onclick="javascript: drawEdges()">
        <br>
        <br>

        <fieldset>
            <legend>
                <h3><b>Legend</b></h3>
            </legend>
            Every strip of nodes indicates a set<br> of sequences with this number of references: <br><br>
            <span class="dot" style="background-color: #132b43"></span>: greater than 40 <br>
            <span class="dot" style="background-color: #1d3f5d"></span>: between 30 and 40 <br>
            <span class="dot" style="background-color: #27547a"></span>: between 20 and 30 <br>
            <span class="dot" style="background-color: #326896"></span>: between 10 and 20 <br>
            <span class="dot" style="background-color: #3d7fb5"></span>: between 5 and 10 <br>
            <span class="dot" style="background-color: #4897d4"></span>: less than 10 <br>
            <span class="dot" style="background-color: #54aef3"></span>: 0
        </fieldset>
    </div>

    <div id="graph"></div>

    <script src="libraries\build\sigma.min.js"></script>

    <script src="libraries\sigma\plugins\sigma.layout.noverlap\sigma.layout.noverlap.js"></script>
    <script src="libraries\sigma\plugins\sigma.plugins.animate\sigma.plugins.animate.js"></script>
    <script src="libraries/sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>

    <script>

        document.getElementById("input").addEventListener("click", clearInput);
        document.getElementById("input2").addEventListener("click", clearInput2);

        var s = new sigma({
            renderer: {
                container: document.getElementById('graph'),
                type: 'canvas'
            }
        });

        s.settings({
            hoverFont: "Comic Sans MS",
            defaultHoverLabelBGColor: "#ffffff",
            defaultLabelColor: "#F70611",
            labelHoverShadowColor: "#000099",
            labelThreshold: 100,
            enableCamera: true,
            enableEdgeHovering: true,
            maxNodeSize: 6,
            autoRescale: true
        });

        var list_refs = [];

        var json_list_initial = sessionStorage.getItem('json_list');
        var json_list = JSON.parse(json_list_initial);

        var take_s = sessionStorage.getItem('take_s');
        var take_sequences = eval('(' + take_s + ')');

        var array_numbers = sessionStorage.getItem('array');

        for (z = 0; z < json_list.length; z++) {
            seq = take_sequences(json_list[z]);
            if (typeof seq !== 'undefined') {
                list_refs.push(seq);
            }
        }

        // First circle

        var json_list_reduced = [];
        var list_refs_reduced = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 40) {
                json_list_reduced.push(json_list[h]);
                list_refs_reduced.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced, 3, "#132b43");

        // Second circle

        var json_list_reduced2 = [];
        var list_refs_reduced2 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 30 && list_refs[h].length <= 40) {
                json_list_reduced2.push(json_list[h]);
                list_refs_reduced2.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced2, 6, "#1d3f5d");

        // Third circle

        var json_list_reduced3 = [];
        var list_refs_reduced3 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 20 && list_refs[h].length <= 30) {
                json_list_reduced3.push(json_list[h]);
                list_refs_reduced3.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced3, 9, "#27547a");

        // Fourth circle

        var json_list_reduced4 = [];
        var list_refs_reduced4 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 10 && list_refs[h].length <= 20) {
                json_list_reduced4.push(json_list[h]);
                list_refs_reduced4.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced4, 12, "#326896");

        // Fifth circle

        var json_list_reduced5 = [];
        var list_refs_reduced5 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length <= 10 && list_refs[h].length > 5) {
                json_list_reduced5.push(json_list[h]);
                list_refs_reduced5.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced5, 15, "#3d7fb5");

        // Sixth circle

        var json_list_reduced6 = [];
        var list_refs_reduced6 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length <= 5) {
                json_list_reduced6.push(json_list[h]);
                list_refs_reduced6.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced6, 18, "#4897d4");

        // Seventh circle

        var json_list_reduced7 = [];
        var list_refs_reduced7 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref === 'undefined') {
                json_list_reduced7.push(json_list[h]);
                list_refs_reduced7.push(list_refs[h]);
            }
        }

        drawCircle(json_list_reduced7, 21, "#54aef3");

        s.refresh();

        function drawEdges() {

            s.graph.clear();

            firstStripe = document.getElementById("input").value;
            secondStripe = document.getElementById("input2").value;

            if ((firstStripe === "1" || firstStripe === "2" || firstStripe === "3" || firstStripe === "4" || firstStripe === "5" || firstStripe === "6" || firstStripe === "7") &&
                (secondStripe === "1" || secondStripe === "2" || secondStripe === "3" || secondStripe === "4" || secondStripe === "5" || secondStripe === "6" || secondStripe === "7")) {

                if (firstStripe === "" && secondStripe === "") {
                    alert("Both stripe not inserted");
                    return;
                } else if (firstStripe === "") {
                    alert("First stripe not inserted");
                    return;
                } else if (secondStripe === "") {
                    alert("Second stripe not inserted");
                    return;
                };

                drawCircle(json_list_reduced, 3, "#132b43");
                drawCircle(json_list_reduced2, 6, "#1d3f5d");
                drawCircle(json_list_reduced3, 9, "#27547a");
                drawCircle(json_list_reduced4, 12, "#326896");
                drawCircle(json_list_reduced5, 15, "#3d7fb5");
                drawCircle(json_list_reduced6, 18, "#4897d4");
                drawCircle(json_list_reduced7, 21, "#54aef3");

                var json_list_for_edges = [];
                var list_refs_for_edges = [];

                var strip1 = document.getElementById("input").value;

                getStrip(strip1, "1", json_list_reduced, list_refs_reduced, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "2", json_list_reduced2, list_refs_reduced2, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "3", json_list_reduced3, list_refs_reduced3, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "4", json_list_reduced4, list_refs_reduced4, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "5", json_list_reduced5, list_refs_reduced5, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "6", json_list_reduced6, list_refs_reduced6, json_list_for_edges, list_refs_for_edges);
                getStrip(strip1, "7", json_list_reduced7, list_refs_reduced7, json_list_for_edges, list_refs_for_edges);

                var json_list_for_edges2 = [];
                var list_refs_for_edges2 = [];

                var strip2 = document.getElementById("input2").value;

                getStrip(strip2, "1", json_list_reduced, list_refs_reduced, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "2", json_list_reduced2, list_refs_reduced2, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "3", json_list_reduced3, list_refs_reduced3, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "4", json_list_reduced4, list_refs_reduced4, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "5", json_list_reduced5, list_refs_reduced5, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "6", json_list_reduced6, list_refs_reduced6, json_list_for_edges2, list_refs_for_edges2);
                getStrip(strip2, "7", json_list_reduced7, list_refs_reduced7, json_list_for_edges2, list_refs_for_edges2);

                drawStripEdges(json_list_for_edges, json_list_for_edges2, list_refs_for_edges);
                drawStripEdges(json_list_for_edges2, json_list_for_edges, list_refs_for_edges2);

                list_edges = s.graph.edges();

                for (q = 0; q < list_edges.length; q++) {
                    for (p = q + 1; p < list_edges.length; p++) {
                        if ((list_edges[q].source === list_edges[p].target) && (list_edges[q].target === list_edges[p].source)) {
                            s.graph.dropEdge(list_edges[p].id);

                        }
                    }
                }

                s.graph.nodes().forEach(element => {

                    var contOk = 0;

                    for (i = 0; i < json_list_for_edges.length; i++) {
                        if (json_list_for_edges[i].query.substring(3, 11) !== element.id) {
                            contOk = contOk + 1;
                        }
                    }

                    for (j = 0; j < json_list_for_edges2.length; j++) {
                        if (json_list_for_edges2[j].query.substring(3, 11) !== element.id) {
                            contOk = contOk + 1;
                        }
                    }

                    if (contOk === (json_list_for_edges2.length + json_list_for_edges.length)) {
                        element.color = "#b3b3b3";
                    }

                });

                s.refresh();

                getNodesOverlap(3);

            } else {

                alert("The value of first and secondo stripe have to be between 1 and 7 (both included)");

            }

        }

        function drawCircle(j_reduced, radius, nodesColor) {

            for (i = 0; i < j_reduced.length; i++) {
                var theta = i * 2 * Math.PI / j_reduced.length;
                s.graph.addNode({
                    id: '' + j_reduced[i].query.substring(3, 11),
                    label: '' + j_reduced[i].query.substring(3, 11),
                    x: radius * Math.sin(theta),
                    y: radius * Math.cos(theta),
                    size: 1,
                    color: nodesColor
                });
            }

        }

        function getStrip(strip, stripNumber, j_reduced, r_reduced, j_edges, r_edges) {
            if (strip === stripNumber) {
                j_reduced.forEach(element => {
                    j_edges.push(element);
                });
                r_reduced.forEach(element => {
                    r_edges.push(element);
                });
            }
        }

        function clearInput() {
            document.getElementById("input").value = "";
        }

        function clearInput2() {
            document.getElementById("input2").value = "";
        }

        function getNodesOverlap(node_m) {
            var config = {
                nodeMargin: node_m,
                scaleNodes: 1.3
            };

            var listener = s.configNoverlap(config);

            s.startNoverlap();
        }

        function drawStripEdges(json_list_strip_start, json_list_strip_end, list_refs_strip_start) {
            for (i = 0; i < json_list_strip_start.length; i++) {
                for (j = 0; j < list_refs_strip_start[i].length; j++) {
                    for (k = 0; k < json_list_strip_end.length; k++) {
                        if (list_refs_strip_start[i][j] === json_list_strip_end[k].query.substring(3, 11) && (i !== k)) {
                            try {
                            s.graph.addEdge({
                                id: 'e' + '(' + i + ',' + k + ')',
                                source: '' + json_list_strip_start[i].query.substring(3, 11),
                                target: '' + json_list_strip_end[k].query.substring(3, 11),
                                size: 1,
                            });
                            } catch(error) {
                                console.log('e' + '(' + i + ',' + k + ')' + ' already exists');
                            }
                        }
                    }
                }
            }
        }

        getNodesOverlap(5);

    </script>

</body>

</html>