<html>

<head>

    <title>
        Big Graph
    </title>

    <style>
        #graph {
            width: 1500px;
            height: 1500px;
        }

        #input {
            width: auto;
            height: auto;
        }

        #input2 {
            width: auto;
            height: auto;
        }

        body {
            background-color: #000000;
        }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>

<body>

    <input type="text" id="input">
    <br>
    <input type="text" id="input2">
    <br>
    <input type="submit" value="Draw edges!" onclick="javascript: drawEdges()">

    <div id="graph"></div>

    <script src="libraries\build\sigma.min.js"></script>

    <script src="libraries\sigma\plugins\sigma.layout.noverlap\sigma.layout.noverlap.js"></script>
    <script src="libraries\sigma\plugins\sigma.plugins.animate\sigma.plugins.animate.js"></script>
    <script src="libraries\sigma\plugins\sigma.layout.forceAtlas2\supervisor.js"></script>
    <script src="libraries\sigma\plugins\sigma.layout.forceAtlas2\worker.js"></script>
    <script src="libraries/sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script>


    <script>

        var array_numbers = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];

        var s = new sigma({
            renderer: {
                container: document.getElementById('graph'),
                type: 'canvas' // This is alse the default render.
            }
        });

        var json_list = [];
        var json_list_support = []; // It'll storage the string with names of json files in the folder fetched.
        var id = 0; // This is useful to storage the id of the last drawed node. 

        $.ajax({ // This ajax request serves to storage the string with names of json files in the folder fetched.
            type: "POST",
            url: "https://localhost/tesi-magistrale/getFetchedInfo.php",
            async: false, // The program 'll wait until this request'll not be executed.
            success: function (list) {
                var end = 9;
                for (p = 2; p < list.length; p = p + 15) {
                    json_list_support.push(list.substring(p, end));
                    end = end + 15;
                }
            },
            error: function () {
                alert("Error in json files reading");
            }
        });

        json_list_support.forEach(element => { // This ajax request purpouse is create a json files list.
            $.ajax({
                type: "POST",
                url: "https://localhost/materiale_Nocentini/oeis-tools-master/src/fetched/" + element + ".json",
                async: false,
                success: function (fileJSON) {
                    json_list.push(fileJSON);
                },
                error: function () {
                    alert("Error in json_list construction");
                }
            });
        });

        function take_sequences(sequenzaJSON) {
            xref_list = sequenzaJSON.results[0].xref;
            if (typeof xref_list !== 'undefined') {
                let array_sequences = [];
                for (i = 0; i < xref_list.length; i++) { // Loop that scans xref elements.
                    element = xref_list[i];
                    for (j = 0; j < element.length; j++) { // Loop that scans the letters of xref elements.
                        if (element[j] === "A") { // Each sequences has the form Axxxxxx.
                            for (v = 0; v < array_numbers.length; v++) {
                                if (element[j + 1] === array_numbers[v] && element.substring(j, j + 7) !== sequenzaJSON
                                    .query.substring(3, 11)) {
                                    array_sequences.push("A" + element.substring(j + 1, j + 7));
                                    j = j +
                                        7; // Useful for optimizing the code. If you find a "A", you can jump the next xxxxxx.
                                    break;
                                }
                            }
                        }
                    }
                }
                var set_sequences = [...new Set(array_sequences)];
                return set_sequences;
            } else {
                return 'undefined';
            }
        }

        s.graph.clear();

        s.settings({
            hoverFont: "Comic Sans MS",
            labelHoverBGColor: "default",
            defaultHoverLabelBGColor: "#ffffff",
            defaultNodeColor: "#e6e600",
            nodeColor: "default",
            defaultEdgeColor: "#000000",
            edgeColor: "default",
            defaultLabelColor: "#F70611",
            labelColor: "default",
            labelHoverShadow: "default",
            labelHoverShadowColor: "#000099",
            labelThreshold: 100,
            enableCamera: true,
            enableEdgeHovering: true,
            maxNodeSize: 6,
            autoRescale: true
        });

        var list_refs = [];

        for (z = 0; z < json_list.length; z++) {
            seq = take_sequences(json_list[z]);
            if (typeof seq !== 'undefined') {
                list_refs.push(seq);
            }
        }

        // First circle

        var json_list_reduced = [];
        var list_refs_reduced = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 40) {
                json_list_reduced.push(json_list[h]);
                list_refs_reduced.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced.length;
            s.graph.addNode({
                id: '' + json_list_reduced[i].query.substring(3, 11),
                label: '' + json_list_reduced[i].query.substring(3, 11),
                x: 3 * Math.sin(theta),
                y: 3 * Math.cos(theta),
                size: 1
            });
        }

        // Second circle

        var json_list_reduced2 = [];
        var list_refs_reduced2 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 30 && list_refs[h].length <= 40) {
                json_list_reduced2.push(json_list[h]);
                list_refs_reduced2.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced2.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced2.length;
            s.graph.addNode({
                id: '' + json_list_reduced2[i].query.substring(3, 11),
                label: '' + json_list_reduced2[i].query.substring(3, 11),
                x: 6 * Math.sin(theta),
                y: 6 * Math.cos(theta),
                size: 1
            });
        }

        // Third circle

        var json_list_reduced3 = [];
        var list_refs_reduced3 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 20 && list_refs[h].length <= 30) {
                json_list_reduced3.push(json_list[h]);
                list_refs_reduced3.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced3.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced3.length;
            s.graph.addNode({
                id: '' + json_list_reduced3[i].query.substring(3, 11),
                label: '' + json_list_reduced3[i].query.substring(3, 11),
                x: 9 * Math.sin(theta),
                y: 9 * Math.cos(theta),
                size: 1
            });
        }

        // Fourth circle

        var json_list_reduced4 = [];
        var list_refs_reduced4 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length > 10 && list_refs[h].length <= 20) {
                json_list_reduced4.push(json_list[h]);
                list_refs_reduced4.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced4.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced4.length;
            s.graph.addNode({
                id: '' + json_list_reduced4[i].query.substring(3, 11),
                label: '' + json_list_reduced4[i].query.substring(3, 11),
                x: 12 * Math.sin(theta),
                y: 12 * Math.cos(theta),
                size: 1
            });
        }

        // Fifth circle

        var json_list_reduced5 = [];
        var list_refs_reduced5 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length <= 10 && list_refs[h].length > 5) {
                json_list_reduced5.push(json_list[h]);
                list_refs_reduced5.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced5.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced5.length;
            s.graph.addNode({
                id: '' + json_list_reduced5[i].query.substring(3, 11),
                label: '' + json_list_reduced5[i].query.substring(3, 11),
                x: 15 * Math.sin(theta),
                y: 15 * Math.cos(theta),
                size: 1
            });
        }

        // Sixth circle

        var json_list_reduced6 = [];
        var list_refs_reduced6 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref !== 'undefined' && list_refs[h].length <= 5) {
                json_list_reduced6.push(json_list[h]);
                list_refs_reduced6.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced6.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced6.length;
            s.graph.addNode({
                id: '' + json_list_reduced6[i].query.substring(3, 11),
                label: '' + json_list_reduced6[i].query.substring(3, 11),
                x: 18 * Math.sin(theta),
                y: 18 * Math.cos(theta),
                size: 1
            });
        }

        // Seventh circle

        var json_list_reduced7 = [];
        var list_refs_reduced7 = [];

        for (h = 0; h < json_list.length; h++) {
            if (typeof json_list[h].results[0].xref === 'undefined') {
                json_list_reduced7.push(json_list[h]);
                list_refs_reduced7.push(list_refs[h]);
            }
        }

        for (i = 0; i < json_list_reduced7.length; i++) {
            var theta = i * 2 * Math.PI / json_list_reduced7.length;
            s.graph.addNode({
                id: '' + json_list_reduced7[i].query.substring(3, 11),
                label: '' + json_list_reduced7[i].query.substring(3, 11),
                x: 21 * Math.sin(theta),
                y: 21 * Math.cos(theta),
                size: 1
            });
        }

        s.refresh();

        function drawEdges() {

            s.graph.edges().forEach( element => {
                s.graph.dropEdge(element.id);
            });

            var json_list_for_edges = [];
            var list_refs_for_edges = [];

            var strip1 = document.getElementById("input").value;

            if (strip1 === "1") {
                json_list_reduced.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "2") {
                json_list_reduced2.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced2.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "3") {
                json_list_reduced3.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced3.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "4") {
                json_list_reduced4.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced4.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "5") {
                json_list_reduced5.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced5.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "6") {
                json_list_reduced6.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced6.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }

            if (strip1 === "7") {
                json_list_reduced7.forEach(element => {
                    json_list_for_edges.push(element);
                });
                list_refs_reduced7.forEach(element => {
                    list_refs_for_edges.push(element);
                });
            }


            // per seconda fascia

            var json_list_for_edges2 = [];
            var list_refs_for_edges2 = [];

            var strip2 = document.getElementById("input2").value;

            if (strip2 === "1") {
                json_list_reduced.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "2") {
                json_list_reduced2.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced2.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "3") {
                json_list_reduced3.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced3.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "4") {
                json_list_reduced4.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced4.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "5") {
                json_list_reduced5.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced5.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "6") {
                json_list_reduced6.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced6.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }

            if (strip2 === "7") {
                json_list_reduced7.forEach(element => {
                    json_list_for_edges2.push(element);
                });
                list_refs_reduced7.forEach(element => {
                    list_refs_for_edges2.push(element);
                });
            }


            for (i = 0; i < json_list_for_edges.length; i++) {
                for (j = 0; j < list_refs_for_edges[i].length; j++) {
                    for (k = 0; k < json_list_for_edges2.length; k++) {
                        if (list_refs_for_edges[i][j] === json_list_for_edges2[k].query.substring(3, 11) && (i !== k)) {
                            s.graph.addEdge({
                                id: 'e' + '(' + i + ',' + k + ')',
                                source: '' + json_list_for_edges[i].query.substring(3, 11),
                                target: '' + json_list_for_edges2[k].query.substring(3, 11),
                                size: 1,
                                color: '#e60000'
                            });
                        }
                    }
                }
            }

            list_edges = s.graph.edges();

            for (q = 0; q < list_edges.length; q++) {
                for (p = q + 1; p < list_edges.length; p++) {
                    if ((list_edges[q].source === list_edges[p].target) && (list_edges[q].target === list_edges[p].source)) {
                        s.graph.dropEdge(list_edges[p].id);

                    }
                }
            }

            s.refresh();

        }

        var config = {
            nodeMargin: 5,
            scaleNodes: 1.3
        };

        var listener = s.configNoverlap(config);

        s.startNoverlap();

        sigma.plugins.dragNodes(s, s.renderers[
            0]);

        /*configuration = {
            scalingRatio: 100000,
            outboundAttractionDistribution: false,
            startingIterations: 10,
            edgeWeightInfluence: 0
        }

        s.startForceAtlas2();
        window.setTimeout(function () { s.killForceAtlas2() }, 200);*/

    </script>

</body>

</html>