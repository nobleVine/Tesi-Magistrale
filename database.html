<html>

<head>

    <title>
        Database
    </title>

    <style>
        input.text {
            width: 100px;
            height: auto;
        }

        input.button {
            width: 130px;
            height: 35px;
            background-color: #d6d6c2;
            border-radius: 6px;
            font-style: italic;
            font-size: 20;
        }

        body {
            background-color: #D3D3D3;
        }

        #queryResults {
            height: auto;
        }
    </style>

</head>

<body>

    <table>
        <tr>
            <td>
                Select the information of interest of a sequence from those in the drop-down menu
            </td>
            <td>
                <input class="text" type="text" id="input1">
            </td>
            <td>
                <input class="button" type="submit" value="Query 1" onclick="javascript: query1()">
            </td>
        </tr>
        <tr>
            <td>
                Select the information of interest of a sequence in the first drop-down menù.
                <br>
                Select from the secondo drop-down menù the string to search inside the information of interest.
            </td>
            <td>
                <input class="text" type="text" id="input2">
                <input class="text" type="text" id="input3">
            </td>
            <td>
                <input class="button" type="submit" value="Query 2" onclick="javascript: query2()">
            </td>
        </tr>
    </table>

    <h3 hidden id="QR">
        <b>
            Query Results:
        </b>
    </h3>

    <!--div id="queryResults">
        
    </div>-->

    <table id="tableResults" border=1>

    </table>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>

        function query1() {

            document.getElementById("QR").style.display = "block";

            $.ajax({
                type: "POST",
                url: "https://localhost/tesi-magistrale/genericQuery.php",
                async: false,
                data: {
                    string: document.getElementById("input1").value
                },
                success: function (queryResults) {

                    var tableResults = document.getElementById("tableResults");

                    if (tableResults === null) {
                        var tableResults = document.createElement("table");
                        tableResults.setAttribute("id", "tableResults");
                        tableResults.setAttribute("border", 1);
                    }

                    while (tableResults.hasChildNodes()) {
                        tableResults.removeChild(tableResults.firstChild);
                    }

                    var input = document.getElementById("input1").value;

                    if (input === "id" || input === "data" || input === "name" || input === "comment" || input === "reference" || input === "formula" || input === "example" || input === "xref") {
                        var array_results = splitString(queryResults);
                    }

                    for (i = 0; i < array_results.length; i = i + 2) {
                        var tr = document.createElement("tr");
                        for (j = i; j < i + 2; j++) {
                            var td = document.createElement("td");
                            td.appendChild(document.createTextNode(array_results[j]));
                            tr.appendChild(td);
                        }
                        tableResults.appendChild(tr);

                    }
                },
                error: function () {
                    alert("Query error!");
                }
            });
        }

        function query2() {

            $.ajax({
                type: "POST",
                url: "https://localhost/tesi-magistrale/queryStringInName.php",
                async: false,
                data: {
                    string1: document.getElementById("input2").value,
                    string2: document.getElementById("input3").value
                },
                success: function (queryResults) {
                    document.getElementById("tableResults").innerHTML = "";
                    queryResults = queryResults.slice(1, queryResults.length - 1);
                    var array_results = queryResults.split(",");
                    array_results.forEach(element => {
                        document.getElementById("tableResults").innerHTML = document.getElementById("tableResults").innerHTML + "<br>" + element;
                    })

                },
                error: function () {
                    alert("Query error!");
                }
            })
        }

        function splitString(queryResults) {

            var array_results = [];
            queryResults = queryResults.slice(1, queryResults.length - 1);
            var finish = false;
            var y = 0;

            for (i = 0; i < queryResults.length; i++) {
                if (queryResults[i] === "i" && queryResults[i + 1] === "d" && queryResults[i + 2] === ":") {
                    finish = false;
                    y = i + 2;
                    while (!finish) {
                        if (queryResults[y] === "i" && queryResults[y + 1] === "d" && queryResults[y + 2] === ":") {
                            array_results.push(queryResults.substring(i + 3, i + 10));
                            array_results.push(queryResults.substring(i + 13, y - 3));
                            finish = true;
                            y = y + 2;
                        } else {
                            y++;
                        }
                    }
                    i = y;
                }
            }

            for (p = 0; p < array_results.length; p++) {
                if (array_results[p] === "ul") {
                    array_results[p] = "null";
                }
            }

            return array_results;

        }

    </script>

</body>



</html>