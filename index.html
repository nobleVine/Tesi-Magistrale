<html>

<head>
    <title>
        Graph Visualization
    </title>

    <style type="text/css">
        body {
            margin: 10;
            background-image: url("back.jpg");
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        #graphSection {
            width: 60%;
            height: 80%;
        }

        input {
            width: 10%;
            word-spacing: 5px;
        }

        #formSection {
            width: 23%;
        }

        #buttonDraw {
            width: 90px;
            height: 35px;
            margin-left: 80px;
        }

        #startingSequence {
            width: 70px;
        }

        #numberOfNodes {
            width: 70px;
        }
    </style>

</head>

<body style="font-size: 15pt; font-family: Comics Sans MS; color: darkorange">

    <center>
        <font size="10">
            Interactive Graph
        </font>
        <br>
        <br>
    </center>
    <div id="formSection" style="float: left;">
        <form action="javascript:drawSpecializedGraph()">
            <table>
                <tr>
                    <td>
                        starting sequence
                    </td>
                    <td>
                        <input type="text" id="startingSequence"
                            title="Insert the id of the sequence that you want to see all the references">
                    </td>
                </tr>
                <tr>
                    <td>
                        number of nodes
                    </td>
                    <td>
                        <input type="text" id="numberOfNodes"
                            title="Insert the maximum number of related sequences that you want to see">
                    </td>
                </tr>
            </table>
            <br>
            <input type="submit" value="Draw It!" id="buttonDraw"
                title="Click here to draw the graph with all the referenced sequences from starting sequence">
        </form>
        <br>
        <br>
        <br>
        <br>
        <br>
        graph with the fetched sequences
        <br>
        <br>
        <form action="javascript:drawFetchedSequencesGraph()">
            <input type="submit" value="Draw It!" id="buttonDraw"
                title="Click here to draw the graph with all the fetched referenced sequences">
        </form>
    </div>

    <div id="graphSection" style="float: left;"></div>

    <script src="C:\Users\Marco\Desktop\Marco\Università\Magistrale\Tesi\libraries\build\sigma.min.js"></script>

    <script src="C:\Users\Marco\Desktop\Marco\Università\Magistrale\Tesi\common_framework\GlobalJSON.json"></script>

    <script>

        array_numbers = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];

        var s = new sigma('graphSection');

        s.settings({
            hoverFont: "Comic Sans MS",
            labelHoverBGColor: "default",
            defaultHoverLabelBGColor: "#F70611",
            defaultNodeColor: "#ffff00",
            nodeColor: "default",
            defaultEdgeColor: "#00ff00",
            edgeColor: "default",
            defaultLabelColor: "#F70611",
            labelColor: "default",
            labelHoverShadow: "default",
            labelHoverShadowColor: "#00ff00",
            labelThreshold: 100
        });

        function take_sequences(sequenzaJSON) {
            xref_list = sequenzaJSON.results[0].xref;
            if (typeof xref_list !== 'undefined') {
                array_sequenze = [];
                for (i = 0; i < xref_list.length; i++) {
                    element = xref_list[i];
                    for (j = 0; j < element.length; j++) {
                        if (element[j] === "A") {
                            for (v = 0; v < array_numbers.length; v++) {
                                if (element[j + 1] === array_numbers[v]) {
                                    array_sequenze.push("A" + element.substring(j + 1, j + 7));
                                    break;
                                }
                            }
                        }
                    }
                }
                let set_sequenze = [...new Set(array_sequenze)];
                return set_sequenze;
            } else {
                return 'undefined';
            }
        }

        function drawSpecializedGraph() {
            s.graph.clear();
            edge_number = 0;
            sequence = document.getElementById("startingSequence").value;
            nodesToAdd = document.getElementById("numberOfNodes").value;
            for (d = 0; d < json_list.length; d++) {
                if (json_list[d].query.substring(3, 11) === sequence) {
                    s.graph.addNode({
                        id: '' + sequence,
                        label: '' + sequence,
                        x: 1,
                        y: 1,
                        size: 5
                    });
                    initial_sequence = json_list[d];
                    break;
                }
            }
            nodes_list = take_sequences(initial_sequence);
            if (nodesToAdd > nodes_list.length) {
                alert("The maximum number of nodes that can be requested is " + nodes_list.length);
            } else {
                for (i = 0; i < nodesToAdd; i++) {
                    var theta = i * 2 * Math.PI / nodesToAdd;
                    s.graph.addNode({
                        id: '' + nodes_list[i],
                        label: '' + nodes_list[i],
                        x: 10 * Math.sin(theta),
                        y: 10 * Math.cos(theta),
                        size: 3
                    }).addEdge({
                        id: 'e' + edge_number,
                        source: '' + sequence,
                        target: '' + nodes_list[i],
                        size: 3
                    });
                    edge_number++;
                }
                s.refresh();
            }
        }

        function drawFetchedSequencesGraph() {

            s.graph.clear();

            lista_refs = [];

            for (z = 0; z < json_list.length; z++) {
                seq = take_sequences(json_list[z]);
                if (typeof seq !== 'undefined') {
                    lista_refs.push(seq);
                }
            }

            for (i = 0; i < json_list.length; i++) {
                var theta = i * 2 * Math.PI / json_list.length;
                s.graph.addNode({
                    id: '' + json_list[i].query.substring(3, 11),
                    label: '' + json_list[i].query.substring(3, 11),
                    x: 10 * Math.sin(theta),
                    y: 10 * Math.cos(theta),
                    size: 1
                });
            }

            for (i = 0; i < json_list.length; i++) {
                for (j = 0; j < lista_refs[i].length; j++) {
                    for (k = 0; k < json_list.length; k++) {
                        if (lista_refs[i][j] === json_list[k].query.substring(3, 11)) {
                            s.graph.addEdge({
                                id: 'e' + '(' + i + ',' + k + ')',
                                source: '' + json_list[i].query.substring(3, 11),
                                target: '' + json_list[k].query.substring(3, 11),
                                size: 1
                            });
                        }
                    }
                }
            }
            s.refresh();
        }

    </script>

</body>

</html>